# Go Booking Service
This Booking Service allows the following:
- Authorize a user using "user" and "password". Returns a signed JWT.
- Validate a JWT. For internal validation.
- Book a room for a desired date. Requires a valid JWT. Returns the booked room id.
- Check the number of available rooms for a desired date. Returns the number of rooms available.

The project is divided in various micoservices:
- Clients: manages client authentication, token generation and validation
- Rooms: manages room access, booking and availability
- Server: proxies the previous services and provides access via HTTP

The services communicate via gRPC.

## Installation

### Clone the repository
```
git clone https://github.com/santiago-tolley/go-booking-service.git
```
### Compile Protobufs
```
protoc pb/clients.proto --go_out=plugins=grpc:.
protoc pb/rooms.proto --go_out=plugins=grpc:.
```
Note: install protoc-gen-go with `go get -u github.com/golang/protobuf/protoc-gen-go`

### Create Go module
```
go mod init go-service-example
```

### Build
```
go build cmd/clients/main.go
go build cmd/rooms/main.go
go build cmd/server/main.go
```

### Set up the database
Create the client user:
```
mongo
use clients-service
db.createUser({user: "clients-service", pwd: "clients-service", roles: [{role: "readWrite", db: "clients-service"}]})
```

Create the room user:
```
mongo
use rooms-service
db.createUser({user: "rooms-service", pwd: "rooms-service", roles: [{role: "readWrite", db: "rooms-service"}]})
```


## Running the Services
Start the services with the following commands:
```
go run cmd/server/main.go
go run cmd/clients/main.go
go run cmd/rooms/main.go
```
The Server service listens on port 8080 (HTTP)
The Clients service listens on port 8082 (gRPC)
The Rooms service listens on port 8081 (gRPC)


## Calling the Proxy
The endpoints can be called using the following cURL commands:
### Authorize: 
```
curl --location --request POST 'localhost:8080/authorize/' \
--header 'Content-Type: application/json' \
--data-raw '{
	"user": "John",
	"password": "pass"
}'
```

### Validate: 
```
curl --location --request POST 'localhost:8080/validate/' \
--header 'Content-Type: application/json' \
--data-raw '{
	"token": "jjj.www.ttt"
}'
```

### Book: 
```
curl --location --request POST 'localhost:8080/book/2020-01-15' \
--header 'Content-Type: application/json' \
--data-raw '{
	"token": "jjj.www.ttt"
}'
```

### Check: 
```
curl --location --request GET 'localhost:8080/check/2020-01-15'
```
Note: the `/book/` and `/validate/` endpoints require a JWT generated by `/authorize/`